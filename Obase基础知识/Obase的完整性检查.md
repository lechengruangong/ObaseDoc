完整性检查是对Obase对象数据模型的校验,分为对象类型通用检查,实体型检查和关联型检查三种.

顾名思义,实体型检查和关联型检查就是对实体型和关联型分别生效的检查,而对象类型通用检查是同时对实体型和关联生效的检查,如果完整性检查没有通过,会抛出特定类型的异常IntegrityCheckFailException.

在IntegrityCheckFailException包含一个Dictionary<string, List<string>>类型的错误消息字典ErrorMessageDictionary,在此字典中可以查看到当前检查失败的消息.

ErrorMessageDictionary的键是类型名称,值是错误消息列表,类型名称包含以下三种:
1. 实体型,就是类型的名称.
2. 显式关联型,就是类型的名称.
3. 隐式关联型,是一个特殊的内部名称,分为三个部分:
   1. 第一部分固定为ImplicitAssociation表示这是一个隐式关联型.
   2. 第二部分为参与此关联各个关联端的类型名称,以下划线作为分隔符.
   3. 第三部分为<>数字组成的定义顺序.

以下是目前已有的完整性检查项目:
1. 对象类型通用检查
   - 检查是否配置了构造器
   - 检查是否配置了映射表
   - 检查配置为继承的类型是否配置了具体类型判别标志
   - 检查配置为继承的类型中作为基类的构造器参数是否与子类的构造函数参数一致
   - 检查每个属性是否都有取值器和设值器
   - 检查引用元素如果被配置为启用延迟加载时所对应的属性是否为virtual的
2. 实体型检查
   - 检查是否配置了主键
   - 检查主键是否是类的属性
   - 检查联合主键是否为不自增的
   - 检查主键如果是自增的是否为整数类型
   - 检查关联引用的左端和右端名称是否可以在关联引用的关联型关联端中找到
   - 检查关联引用是否有取值器和设值器
   - 检查关联引用的左端和右端是否是不一致的
3. 关联型检查
   - 检查关联端的数量是否大于等于2
   - 检查关联端是否为关联型的属性
   - 检查关联端的映射中是否有重复的映射
   - 检查关联端的映射键属性是否都是关联端实体型的主键
   - 检查关联端实体型的主键是否在关联端的映射中有唯一映射
   - 检查关联端是否有取值器和设值器

在大多数情况下,完整性检查都是帮助我们进行模型校验不可或缺的一步,但如果你确定自己的配置没有任何问题但是和完整性检查相违背,可以在配置提供器CreateModel(ModelBuilder modelBuilder)的参数modelBuilder上调用HasIntegrityCheck(false)来关闭完整性检查.