对于一个类型被注册为实体型或者关联型后,Obase会默认的为其配置属性,关联引用,关联端这些类型元素的取值器,设值器,默认映射等配置,创建这些默认值的过程在Obase中称之为反射建模.


在6.2中,总结以往的领域模型的配置逻辑后,Obase加入了大量的推断,用以辅助进行Obase的反射建模配置.

这些推断是根据诸多领域模型的映射逻辑提炼而来的,当进行技术建模的模型实现与推断相符时,可以不必在Obase上进行显式的配置,Obase的对象数据模型可以自动创建.

推断共分为两大部分,结构化类型推断和类型元素推断.

## 结构化类型推断

结构化类型的推断发生在建模中的两个过程里,一个是在调用ModelBuilder的RegisterType(Assembly assembly)方法时,此处会将符合推断的类型注册为结构化类型,另外一个是在对所有已配置的结构化类型进行配置时,会将符合推断的配置项进行配置.

以下将这两个推断过程分别称之为注册推断和配置推断.**这里所说的推断为都是指尝试按照此逻辑进行配置,如果已有相同的配置,则这些推断不生效.**

注册推断决定了什么样的类型会被推断为哪种结构化类型或者类型元素,配置推断决定了符合什么条件会被推断成必须的配置.

### 共通部分

#### 注册推断

1. 被忽略的类型,即通过ModelBuilder的Ignore方法添加的类型,不参与注册推断.

2. 已配置的类型,即已经在建模器内注册过的类型,不参与注册推断.

3. 枚举,接口,抽象类不参与推断.

#### 配置推断

如果此类型存在无参的构造函数,将首个无参构造函数推断为结构化类型的构造函数,

此种构造函数可以是public,protected的.

### 实体型推断

#### 注册推断

对于存在名称为id,code,类名id,类名code的属性且属性类型是int,long,short和string类型的类,推断为实体型.

#### 配置推断

1. 将实体型的类名推断为映射表名.

2. 存在名称为id,code,类名id,类名code的属性,将这些属性都推断为主键.

3. 如果主键仅有一个,且此主键为int,shor,long类型,且未配置过是否自增,此主键推断为自增.

### 显式关联型推断

#### 注册推断

对于不存在名称为id,code,类名id,类名code的属性且属性类型是int,long,short和string类型的类,推断为显式关联型.

#### 配置推断

1. 将显式关联型的类名推断为映射表名.

2. 将显式关联型推断为显式关联.

### 隐式关联型推断

#### 注册推断

对于实体型中定义的访问器,如果类型为实体(包含自身)或其集合,推断两实体间存在二方隐式关联.如果类型为Tuple(或其集合),且各项的类型为实体,推断这些实体间存在多方隐式关联.

#### 配置推断

1. 对于两方关联,按照如下规则进行推断:A上B一对一,B上A一对一,不进行推断;A上B,一对一,B上A,一对多,关联表推断为A;A上B,一对一,B上A,没有,关联表设为A;A上B,一对多,B上A,一对多,关联表设为AAssB;A上B,一对多,B上A,没有,关联表设为B.

2. 将隐式关联型推断为隐式关联.

### 复杂类型推断

#### 注册推断

对于结构体,推断为复杂类型.

#### 配置推断

复杂类型无配置推断.

## 类型元素推断

类型元素推断发生在已经根据结构化类型配置创建结构化类型后,对该类型的属性进行反射处理时.

### 共通部分

#### 注册推断

1. 被忽略的属性,即通过结构化类型配置的Ignore方法添加的属性,不参与注册推断.

2. 已配置的属性,即已经此结构化类型内注册过的属性,不参与注册推断.

#### 配置推断

共通部分无配置推断.

### 属性推断

#### 注册推断

将属性类型为Obase的基元类型( obase#K-1)的属性(public,protected internal)推断为属性.

#### 配置推断

1. 将属性名称推断为映射字段名称.

2. 将属性Get方法推断为取值器方法.

3. 将属性Set方法推断为设置器方法.

### 关联端推断

#### 注册推断

将关联型(显式或隐式)属性类型是已注册的实体型的属性(public,protected internal)推断为关联端.

#### 配置推断

1. 将属性Get方法推断为取值器方法.

2. 将属性Set方法推断为设置器方法.

3. 将当前端类型对应的实体型的主键都推断为映射.如果当前端实体型的映射表与关联型的映射表不为同一张表,映射为<主键,类名+主键>,否则映射为<主键,主键>.

### 关联引用推断

#### 注册推断

将实体型属性类型是已注册的实体型或关联型(显式或隐式)的属性(public,protected internal)推断为关联引用.

#### 配置推断

1. 将属性Get方法推断为取值器方法

2. 将属性Set方法推断为设置器方法.

3. 如果当前关联引用所使用关联型的属性中,与当前引用所属的实体型类型相同的端推断为左端.反之推断为右端.
